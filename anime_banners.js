
window.ANIME_BANNERS = {
  
  characters: [
    
    {
      id: "arthur_ascended",
      name: "Arthur - Ascended King",
      rarity: "mythical",
      image: "https://via.placeholder.com/60x60/ff00ff/fff?text=AA",
      power: 2000,
      health: 2500,
      abilities: ["Ascended Form", "Realmheart Mastery", "Aether God"],
      series: "TBATE",
      chance: 0.00005,
      value: 10000,
      exclusive: true
    },
    {
      id: "sylvie_ascended",
      name: "Sylvie - Ascended Dragon",
      rarity: "mythical",
      image: "https://via.placeholder.com/60x60/00ffff/000?text=SA",
      power: 1800,
      health: 2200,
      abilities: ["Ascended Dragon", "Aether Mastery", "Spatial God"],
      series: "TBATE",
      chance: 0.00005,
      value: 9000,
      exclusive: true
    },
    {
      id: "goku_ultra",
      name: "Goku Ultra Instinct",
      rarity: "mythical",
      image: "https://via.placeholder.com/60x60/ffffff/000?text=GU",
      power: 1900,
      health: 2000,
      abilities: ["Ultra Instinct", "God Ki", "Perfect Dodge"],
      series: "Dragon Ball",
      chance: 0.0001,
      value: 8000,
      exclusive: true
    },
    {
      id: "naruto_baryon",
      name: "Naruto Baryon Mode",
      rarity: "mythical",
      image: "https://via.placeholder.com/60x60/ff6600/fff?text=NB",
      power: 1700,
      health: 1800,
      abilities: ["Baryon Mode", "Kurama Fusion", "Life Force"],
      series: "Naruto",
      chance: 0.0001,
      value: 7500,
      exclusive: true
    },
    {
      id: "ichigo_bankai",
      name: "Ichigo True Bankai",
      rarity: "mythical",
      image: "https://via.placeholder.com/60x60/000000/fff?text=IB",
      power: 1600,
      health: 1700,
      abilities: ["True Bankai", "Hollow Powers", "Quincy Blood"],
      series: "Bleach",
      chance: 0.0001,
      value: 7000,
      exclusive: true
    },
    
    // MYTHICAL CHARACTERS (TBATE - Ultra Ultra Rare)
    {
      id: "arthur_king",
      name: "Arthur Leywin - King",
      rarity: "mythical",
      image: "https://via.placeholder.com/60x60/ff00ff/fff?text=AK",
      power: 1500,
      health: 2000,
      abilities: ["Realmheart", "Aether Core", "King's Authority"],
      series: "TBATE",
      chance: 0.0001,
      value: 5000
    },
    {
      id: "arthur_white",
      name: "Arthur - White Core",
      rarity: "mythical",
      image: "https://via.placeholder.com/60x60/ffffff/000?text=AW",
      power: 1200,
      health: 1500,
      abilities: ["White Core", "Aether Manipulation", "Spatial Magic"],
      series: "TBATE",
      chance: 0.0002,
      value: 4000
    },
    {
      id: "arthur_silver",
      name: "Arthur - Silver Core",
      rarity: "mythical",
      image: "https://via.placeholder.com/60x60/c0c0c0/000?text=AS",
      power: 1000,
      health: 1300,
      abilities: ["Silver Core", "Lightning Magic", "Sword Arts"],
      series: "TBATE",
      chance: 0.0003,
      value: 3000
    },
    {
      id: "arthur_red",
      name: "Arthur - Red Core",
      rarity: "mythical",
      image: "https://via.placeholder.com/60x60/ff0000/fff?text=AR",
      power: 800,
      health: 1100,
      abilities: ["Red Core", "Fire Magic", "Beast Will"],
      series: "TBATE",
      chance: 0.0005,
      value: 2500
    },
    {
      id: "sylvie_dragon",
      name: "Sylvie - Dragon Form",
      rarity: "mythical",
      image: "https://via.placeholder.com/60x60/00ffff/000?text=SD",
      power: 1300,
      health: 1800,
      abilities: ["Dragon Form", "Aether Wings", "Spatial Travel"],
      series: "TBATE",
      chance: 0.0001,
      value: 4500
    },
    {
      id: "regis_weapon",
      name: "Regis - Weapon Form",
      rarity: "mythical",
      image: "https://via.placeholder.com/60x60/800080/fff?text=RW",
      power: 1100,
      health: 1400,
      abilities: ["Weapon Form", "Aether Blade", "Soul Fire"],
      series: "TBATE",
      chance: 0.0002,
      value: 3500
    },
    
    // Legendary Characters
    {
      id: "naruto_sage",
      name: "Naruto Sage Mode",
      rarity: "legendary",
      image: "https://i.imgur.com/8XZqJ3L.png",
      power: 95,
      health: 100,
      abilities: ["Rasengan", "Shadow Clone", "Sage Mode"],
      series: "Naruto",
      chance: 0.001,
      value: 1000
    },
    {
      id: "goku_ssj",
      name: "Goku Super Saiyan",
      rarity: "legendary",
      image: "https://i.imgur.com/QW3K9Yp.png",
      power: 98,
      health: 95,
      abilities: ["Kamehameha", "Instant Transmission", "Super Saiyan"],
      series: "Dragon Ball",
      chance: 0.001,
      value: 1000
    },
    {
      id: "ichigo_bankai",
      name: "Ichigo Bankai",
      rarity: "legendary",
      image: "https://i.imgur.com/L2X8K9M.png",
      power: 92,
      health: 90,
      abilities: ["Getsuga Tensho", "Bankai", "Hollow Mask"],
      series: "Bleach",
      chance: 0.001,
      value: 1000
    },
    {
      id: "luffy_gear4",
      name: "Luffy Gear 4",
      rarity: "legendary",
      image: "https://i.imgur.com/N7X2K4P.png",
      power: 90,
      health: 85,
      abilities: ["Gomu Gomu no Pistol", "Gear 4", "Haki"],
      series: "One Piece",
      chance: 0.001,
      value: 1000
    },
    {
      id: "saitama_serious",
      name: "Saitama Serious",
      rarity: "legendary",
      image: "https://i.imgur.com/K9X1L2M.png",
      power: 100,
      health: 100,
      abilities: ["Serious Punch", "One Punch", "Limitless Power"],
      series: "One Punch Man",
      chance: 0.0005,
      value: 2000
    },
    {
      id: "all_might",
      name: "All Might",
      rarity: "legendary",
      image: "https://i.imgur.com/P7X3N4Q.png",
      power: 96,
      health: 88,
      abilities: ["United States of Smash", "One For All", "Plus Ultra"],
      series: "My Hero Academia",
      chance: 0.001,
      value: 1000
    },
    
    // Epic Characters
    {
      id: "sasuke_ms",
      name: "Sasuke Mangekyo",
      rarity: "epic",
      image: "https://i.imgur.com/P9X1K6L.png",
      power: 85,
      health: 80,
      abilities: ["Chidori", "Mangekyo Sharingan", "Susanoo"],
      series: "Naruto",
      chance: 0.05,
      value: 200
    },
    {
      id: "vegeta_ssj",
      name: "Vegeta Super Saiyan",
      rarity: "epic",
      image: "https://i.imgur.com/R4X5K2N.png",
      power: 88,
      health: 85,
      abilities: ["Final Flash", "Galick Gun", "Super Saiyan"],
      series: "Dragon Ball",
      chance: 0.05,
      value: 200
    },
    {
      id: "rukia_bankai",
      name: "Rukia Bankai",
      rarity: "epic",
      image: "https://i.imgur.com/T6X7K8Q.png",
      power: 75,
      health: 70,
      abilities: ["Sode no Shirayuki", "Bankai", "Ice Magic"],
      series: "Bleach",
      chance: 0.05,
      value: 200
    },
    {
      id: "zoro_ashura",
      name: "Zoro Ashura",
      rarity: "epic",
      image: "https://i.imgur.com/U8X9K0R.png",
      power: 82,
      health: 75,
      abilities: ["Santoryu", "Ashura", "Haki"],
      series: "One Piece",
      chance: 0.05,
      value: 200
    },
    {
      id: "genos_incineration",
      name: "Genos Incineration",
      rarity: "epic",
      image: "https://i.imgur.com/V2X4M6P.png",
      power: 78,
      health: 65,
      abilities: ["Incineration Cannon", "Machine Gun Blows", "Rocket Punch"],
      series: "One Punch Man",
      chance: 0.05,
      value: 200
    },
    {
      id: "bakugo_explosion",
      name: "Bakugo Explosion",
      rarity: "epic",
      image: "https://i.imgur.com/W5X7N9Q.png",
      power: 80,
      health: 72,
      abilities: ["Explosion", "Howitzer Impact", "AP Shot"],
      series: "My Hero Academia",
      chance: 0.05,
      value: 200
    },
    
    // Rare Characters
    {
      id: "sakura_tsunade",
      name: "Sakura Tsunade Style",
      rarity: "rare",
      image: "https://i.imgur.com/V0X1K3S.png",
      power: 65,
      health: 85,
      abilities: ["Medical Ninjutsu", "Super Strength", "Byakugou"],
      series: "Naruto",
      chance: 1.5,
      value: 50
    },
    {
      id: "gohan_teen",
      name: "Teen Gohan",
      rarity: "rare",
      image: "https://i.imgur.com/W2X3K5T.png",
      power: 70,
      health: 75,
      abilities: ["Masenko", "Super Saiyan", "Kamehameha"],
      series: "Dragon Ball",
      chance: 1.5,
      value: 50
    },
    {
      id: "renji_bankai",
      name: "Renji Bankai",
      rarity: "rare",
      image: "https://i.imgur.com/X4X5K7U.png",
      power: 68,
      health: 70,
      abilities: ["Zabimaru", "Bankai", "Snake Fang"],
      series: "Bleach",
      chance: 1.5,
      value: 50
    },
    {
      id: "sanji_diable",
      name: "Sanji Diable Jambe",
      rarity: "rare",
      image: "https://i.imgur.com/Y6X7K9V.png",
      power: 72,
      health: 65,
      abilities: ["Diable Jambe", "Sky Walk", "Haki"],
      series: "One Piece",
      chance: 1.5,
      value: 50
    },
    {
      id: "speed_o_sound",
      name: "Speed-o'-Sound Sonic",
      rarity: "rare",
      image: "https://i.imgur.com/Z8X9K1W.png",
      power: 68,
      health: 60,
      abilities: ["Shadow Burial", "Four Shadows Burial", "Ultimate Hellfire Burst"],
      series: "One Punch Man",
      chance: 1.5,
      value: 50
    },
    {
      id: "todoroki_ice",
      name: "Todoroki Ice & Fire",
      rarity: "rare",
      image: "https://i.imgur.com/A0X1K3X.png",
      power: 75,
      health: 70,
      abilities: ["Half-Cold Half-Hot", "Ice Wall", "Flashfreeze Heatwave"],
      series: "My Hero Academia",
      chance: 1.5,
      value: 50
    },
    
    // Common Characters
    {
      id: "kakashi_copy",
      name: "Kakashi Copy Ninja",
      rarity: "common",
      image: "https://i.imgur.com/Z8X9K1W.png",
      power: 45,
      health: 60,
      abilities: ["Chidori", "Sharingan", "Copy Ninjutsu"],
      series: "Naruto",
      chance: 12,
      value: 10
    },
    {
      id: "krillin_destructo",
      name: "Krillin Destructo Disk",
      rarity: "common",
      image: "https://i.imgur.com/A0X1K3X.png",
      power: 40,
      health: 55,
      abilities: ["Kamehameha", "Destructo Disk", "Solar Flare"],
      series: "Dragon Ball",
      chance: 12,
      value: 10
    },
    {
      id: "chad_fullbring",
      name: "Chad Fullbring",
      rarity: "common",
      image: "https://i.imgur.com/B2X3K5Y.png",
      power: 42,
      health: 65,
      abilities: ["Fullbring", "Enhanced Strength", "Shield"],
      series: "Bleach",
      chance: 12,
      value: 10
    },
    {
      id: "usopp_sogeking",
      name: "Usopp Sogeking",
      rarity: "common",
      image: "https://i.imgur.com/C4X5K7Z.png",
      power: 35,
      health: 50,
      abilities: ["Pop Green", "Sniper", "Kabuto"],
      series: "One Piece",
      chance: 12,
      value: 10
    },
    {
      id: "mumen_rider",
      name: "Mumen Rider",
      rarity: "common",
      image: "https://i.imgur.com/D6X7K9A.png",
      power: 30,
      health: 45,
      abilities: ["Justice Crash", "Bicycle", "Courage"],
      series: "One Punch Man",
      chance: 12,
      value: 10
    },
    {
      id: "mineta_grape",
      name: "Mineta Grape Rush",
      rarity: "common",
      image: "https://i.imgur.com/E8X9K1B.png",
      power: 38,
      health: 40,
      abilities: ["Pop Off", "Grape Rush", "Sticky Balls"],
      series: "My Hero Academia",
      chance: 12,
      value: 10
    }
  ],

  // Aura System
  auras: [
    {
      id: "fire_aura",
      name: "Fire Aura",
      rarity: "epic",
      image: "https://i.imgur.com/D6X7K9A.png",
      power: 15,
      effect: "Burns enemies for 5 damage per turn",
      chance: 0.1,
      value: 150
    },
    {
      id: "ice_aura",
      name: "Ice Aura",
      rarity: "epic",
      image: "https://i.imgur.com/E8X9K1B.png",
      power: 12,
      effect: "Freezes enemies, reducing their speed",
      chance: 0.1,
      value: 150
    },
    {
      id: "lightning_aura",
      name: "Lightning Aura",
      rarity: "rare",
      image: "https://i.imgur.com/F0X1K3C.png",
      power: 10,
      effect: "Stuns enemies occasionally",
      chance: 1.0,
      value: 80
    },
    {
      id: "wind_aura",
      name: "Wind Aura",
      rarity: "rare",
      image: "https://i.imgur.com/G2X3K5D.png",
      power: 8,
      effect: "Increases evasion by 20%",
      chance: 1.0,
      value: 80
    },
    {
      id: "earth_aura",
      name: "Earth Aura",
      rarity: "common",
      image: "https://i.imgur.com/H4X5K7E.png",
      power: 5,
      effect: "Increases defense by 15%",
      chance: 8,
      value: 30
    },
    {
      id: "void_aura",
      name: "Void Aura",
      rarity: "legendary",
      image: "https://i.imgur.com/I6X7K9F.png",
      power: 25,
      effect: "Absorbs enemy attacks and reflects damage",
      chance: 0.01,
      value: 500
    }
  ],

  // Boss System
  bosses: [
    {
      id: "madara_eternal",
      name: "Madara Uchiha (Eternal)",
      rarity: "legendary",
      image: "https://i.imgur.com/J8X9K1G.png",
      power: 120,
      health: 150,
      abilities: ["Susanoo", "Eternal Mangekyo", "Wood Release"],
      series: "Naruto",
      reward: 500,
      xpReward: 1000,
      chance: 0.001
    },
    {
      id: "frieza_golden",
      name: "Golden Frieza",
      rarity: "legendary",
      image: "https://i.imgur.com/K0X1K3H.png",
      power: 125,
      health: 140,
      abilities: ["Death Beam", "Golden Form", "Destructo Disk"],
      series: "Dragon Ball",
      reward: 500,
      xpReward: 1000,
      chance: 0.001
    },
    {
      id: "aizen_hogyoku",
      name: "Aizen Hogyoku",
      rarity: "legendary",
      image: "https://i.imgur.com/L2X3K5I.png",
      power: 115,
      health: 130,
      abilities: ["Kyoka Suigetsu", "Hogyoku", "Cero"],
      series: "Bleach",
      reward: 500,
      xpReward: 1000,
      chance: 0.001
    },
    {
      id: "kaido_dragon",
      name: "Kaido Dragon Form",
      rarity: "legendary",
      image: "https://i.imgur.com/M4X5K7J.png",
      power: 110,
      health: 160,
      abilities: ["Dragon Form", "Thunder Bagua", "Boro Breath"],
      series: "One Piece",
      reward: 500,
      xpReward: 1000,
      chance: 0.001
    },
    {
      id: "garou_monster",
      name: "Monster Garou",
      rarity: "epic",
      image: "https://i.imgur.com/N6X7K9K.png",
      power: 85,
      health: 100,
      abilities: ["Monster Calamity God Slayer Fist", "Awakened Breath", "Cross Fang Dragon Slayer Fist"],
      series: "One Punch Man",
      reward: 200,
      xpReward: 500,
      chance: 0.05
    },
    {
      id: "all_for_one",
      name: "All For One",
      rarity: "epic",
      image: "https://i.imgur.com/O8X9K1L.png",
      power: 90,
      health: 95,
      abilities: ["All For One", "Air Cannon", "Impact Recoil"],
      series: "My Hero Academia",
      reward: 200,
      xpReward: 500,
      chance: 0.05
    }
  ],

  // Potion System with Timers
  potions: [
    {
      id: "luck_boost_1",
      name: "Luck Boost I",
      rarity: "common",
      image: "https://i.imgur.com/P0X1K3M.png",
      effect: "Increases legendary chance by 0.1% for 10 minutes",
      duration: 600000, 
      cost: 50,
      boost: 0.001
    },
    {
      id: "luck_boost_2",
      name: "Luck Boost II",
      rarity: "rare",
      image: "https://i.imgur.com/Q2X3K5N.png",
      effect: "Increases legendary chance by 0.3% for 15 minutes",
      duration: 900000,
      cost: 150,
      boost: 0.003
    },
    {
      id: "luck_boost_3",
      name: "Luck Boost III",
      rarity: "epic",
      image: "https://i.imgur.com/R4X5K7O.png",
      effect: "Increases legendary chance by 0.5% for 20 minutes",
      duration: 1200000, // 20 minutes
      cost: 300,
      boost: 0.005
    },
    {
      id: "luck_boost_4",
      name: "Luck Boost IV",
      rarity: "legendary",
      image: "https://i.imgur.com/S6X7K9P.png",
      effect: "Increases legendary chance by 1% for 30 minutes",
      duration: 1800000, // 30 minutes
      cost: 1000,
      boost: 0.01
    },
    {
      id: "xp_boost_1",
      name: "XP Boost I",
      rarity: "common",
      image: "https://i.imgur.com/T8X9K1Q.png",
      effect: "Doubles XP gain for 10 minutes",
      duration: 600000,
      cost: 75,
      multiplier: 2
    },
    {
      id: "xp_boost_2",
      name: "XP Boost II",
      rarity: "rare",
      image: "https://i.imgur.com/U0X1K3R.png",
      effect: "Triples XP gain for 15 minutes",
      duration: 900000,
      cost: 200,
      multiplier: 3
    },
    {
      id: "coin_boost_1",
      name: "Coin Boost I",
      rarity: "common",
      image: "https://i.imgur.com/V2X3K5S.png",
      effect: "Doubles coin gain for 10 minutes",
      duration: 600000,
      cost: 100,
      multiplier: 2
    },
    {
      id: "coin_boost_2",
      name: "Coin Boost II",
      rarity: "rare",
      image: "https://i.imgur.com/W4X5K7T.png",
      effect: "Triples coin gain for 15 minutes",
      duration: 900000,
      cost: 250,
      multiplier: 3
    },
    {
      id: "power_boost_1",
      name: "Power Boost I",
      rarity: "epic",
      image: "https://i.imgur.com/X6X7K9U.png",
      effect: "Increases character power by 20% for 20 minutes",
      duration: 1200000,
      cost: 400,
      boost: 0.2
    },
    {
      id: "power_boost_2",
      name: "Power Boost II",
      rarity: "legendary",
      image: "https://i.imgur.com/Y8X9K1V.png",
      effect: "Increases character power by 50% for 30 minutes",
      duration: 1800000,
      cost: 1200,
      boost: 0.5
    }
  ],

  // Utility Functions
  getCharacterById: function(id) {
    return this.characters.find(char => char.id === id);
  },
  
  getRandomCharacter: function() {
    const random = Math.random();
    let cumulativeChance = 0;
    
    for (let char of this.characters) {
      cumulativeChance += char.chance;
      if (random <= cumulativeChance) {
        return { ...char };
      }
    }
    
    // Fallback to first character
    return { ...this.characters[0] };
  },
  
  getRandomAura: function() {
    const random = Math.random();
    let cumulativeChance = 0;
    
    for (let aura of this.auras) {
      cumulativeChance += aura.chance;
      if (random <= cumulativeChance) {
        return { ...aura };
      }
    }
    
    // Fallback to first aura
    return { ...this.auras[0] };
  },

  getAuraById: function(id) {
    return this.auras.find(aura => aura.id === id);
  },

  getBossById: function(id) {
    return this.bosses.find(boss => boss.id === id);
  },

  getPotionById: function(id) {
    return this.potions.find(potion => potion.id === id);
  },

  getCharactersByRarity: function(rarity) {
    return this.characters.filter(char => char.rarity === rarity);
  },

  getRandomCharacter: function() {
    const totalChance = this.characters.reduce((sum, char) => sum + char.chance, 0);
    let random = Math.random() * totalChance;
    
    for (let char of this.characters) {
      random -= char.chance;
      if (random <= 0) {
        return { ...char };
      }
    }
    return this.characters[0]; // Fallback
  },

  getRandomBoss: function() {
    const totalChance = this.bosses.reduce((sum, boss) => sum + boss.chance, 0);
    let random = Math.random() * totalChance;
    
    for (let boss of this.bosses) {
      random -= boss.chance;
      if (random <= 0) {
        return { ...boss };
      }
    }
    return this.bosses[0]; // Fallback
  },

  generateAISquad: function() {
    const squad = [];
    const rarities = ['common', 'rare', 'epic', 'legendary'];
    const weights = [0.6, 0.25, 0.12, 0.03];
    
    for (let i = 0; i < 4; i++) {
      const rarity = this.getRandomRarity(weights);
      const characters = this.characters.filter(char => char.rarity === rarity);
      if (characters.length > 0) {
        const character = { ...characters[Math.floor(Math.random() * characters.length)] };
        character.equippedAura = null;
        squad.push(character);
      }
    }
    
    return squad;
  },

  getRandomRarity: function(weights) {
    const rand = Math.random();
    let cumulative = 0;
    const rarities = ['common', 'rare', 'epic', 'legendary'];
    
    for (let i = 0; i < weights.length; i++) {
      cumulative += weights[i];
      if (rand <= cumulative) {
        return rarities[i];
      }
    }
    return 'common';
  },

  calculateBattleResult: function(playerSquad, aiSquad) {
    let playerPower = 0;
    let aiPower = 0;
    
    playerSquad.forEach(char => {
      let charPower = char.power;
      if (char.equippedAura) {
        charPower += char.equippedAura.power;
      }
      playerPower += charPower;
    });
    
    aiSquad.forEach(char => {
      let charPower = char.power;
      if (char.equippedAura) {
        charPower += char.equippedAura.power;
      }
      aiPower += charPower;
    });
    
    
    const playerRoll = Math.random() * 20 - 10;
    const aiRoll = Math.random() * 20 - 10;
    
    playerPower += playerRoll;
    aiPower += aiRoll;
    
    return {
      playerPower: Math.max(0, playerPower),
      aiPower: Math.max(0, aiPower),
      playerWins: playerPower > aiPower,
      battleLog: this.generateBattleLog(playerSquad, aiSquad, playerPower, aiPower)
    };
  },

  generateBattleLog: function(playerSquad, aiSquad, playerPower, aiPower) {
    const log = [];
    log.push("⚔️ Battle Start!");
    
    playerSquad.forEach((char, i) => {
      const aiChar = aiSquad[i] || aiSquad[0];
      const charPower = char.power + (char.equippedAura ? char.equippedAura.power : 0);
      const aiCharPower = aiChar.power + (aiChar.equippedAura ? aiChar.equippedAura.power : 0);
      
      if (charPower > aiCharPower) {
        log.push(`✅ ${char.name} defeats ${aiChar.name}!`);
      } else {
        log.push(`❌ ${char.name} loses to ${aiChar.name}!`);
      }
    });
    
    log.push(`\n🎯 Final Power: ${Math.round(playerPower)} vs ${Math.round(aiPower)}`);
    log.push(playerPower > aiPower ? "🏆 Victory!" : "💀 Defeat!");
    
    return log;
  },

  
  applyPotionEffect: function(potionId, user) {
    const potion = this.getPotionById(potionId);
    if (!potion) return false;

    const activeEffects = user.activeEffects || {};
    const now = Date.now();
    
    
    if (activeEffects[potionId] && activeEffects[potionId].expires > now) {
      return false; 
    }

   
    activeEffects[potionId] = {
      expires: now + potion.duration,
      effect: potion.effect,
      boost: potion.boost,
      multiplier: potion.multiplier
    };

    user.activeEffects = activeEffects;
    return true;
  },

  getActiveEffects: function(user) {
    const activeEffects = user.activeEffects || {};
    const now = Date.now();
    const active = {};

    for (let [potionId, effect] of Object.entries(activeEffects)) {
      if (effect.expires > now) {
        active[potionId] = effect;
      }
    }

    return active;
  },

  cleanupExpiredEffects: function(user) {
    const activeEffects = user.activeEffects || {};
    const now = Date.now();
    const cleaned = {};

    for (let [potionId, effect] of Object.entries(activeEffects)) {
      if (effect.expires > now) {
        cleaned[potionId] = effect;
      }
    }

    user.activeEffects = cleaned;
    return cleaned;
  }
};


if (typeof module !== 'undefined' && module.exports) {
  module.exports = window.ANIME_BANNERS;
}
